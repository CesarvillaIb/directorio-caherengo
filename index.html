<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Directorio General | Cahrengo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
*{box-sizing:border-box;font-family:Segoe UI,Arial}
body{
  margin:0;
  background:linear-gradient(180deg,#0b1c3d,#050b1a);
  color:#fff;
}
header{
  background:linear-gradient(90deg,#2563eb,#1e40af);
  padding:30px;
  text-align:center;
}
header h1{margin:0;font-size:28px}
header p{opacity:.9}

.search-box{
  margin:20px auto;
  max-width:500px;
}
.search-box input{
  width:100%;
  padding:14px;
  border-radius:25px;
  border:none;
  font-size:15px;
}

.filters{
  display:flex;
  justify-content:center;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:20px;
}
.filters button{
  padding:8px 14px;
  border-radius:20px;
  border:none;
  cursor:pointer;
  background:#0f172a;
  color:#fff;
}
.filters button.active{background:#2563eb}

.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:20px;
  padding:20px;
}

.card{
  background:linear-gradient(180deg,#0f172a,#020617);
  border-radius:18px;
  padding:20px;
  position:relative;
  animation:fade .4s ease;
}
@keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1}}

.card h3{margin:0}
.tag{
  display:inline-block;
  background:#020617;
  padding:5px 10px;
  border-radius:14px;
  font-size:12px;
  margin:6px 0;
}

.info{
  background:#020617;
  border-radius:12px;
  padding:10px;
  margin-top:8px;
  word-break:break-all;
}

.actions{
  display:flex;
  gap:10px;
  margin-top:10px;
}
.actions button{
  flex:1;
  padding:10px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  font-size:16px;
}
.mail{background:#2563eb;color:#fff}
.phone{background:#10b981;color:#fff}
.whats{background:#22c55e;color:#fff}

.edit-icons{
  position:absolute;
  top:10px;
  right:10px;
  display:flex;
  gap:8px;
}
.edit-icons i{
  cursor:pointer;
  font-size:14px;
  opacity:.7;
}
.edit-icons i:hover{opacity:1}

.fab{
  position:fixed;
  right:25px;
  bottom:25px;
  width:55px;
  height:55px;
  border-radius:50%;
  background:#2563eb;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  <h1>ðŸ“± Directorio General</h1>
  <p>Cahrengo Â· Uso interno</p>
</header>

<div class="search-box">
  <input id="search" placeholder="Buscar por nombre, Ã¡rea, correo, telÃ©fono u oficina...">
</div>

<div class="filters">
  <button class="active" onclick="setOffice('')">Todas</button>
  <button onclick="setOffice('Aguascalientes')">Aguascalientes</button>
  <button onclick="setOffice('Zapopan')">Zapopan</button>
  <button onclick="setOffice('Tlajomulco')">Tlajomulco</button>
  <button onclick="setOffice('Guerrero Negro')">Guerrero Negro</button>
  <button onclick="setOffice('MÃ©rida')">MÃ©rida</button>
</div>

<div class="cards" id="cards"></div>

<div class="fab" onclick="addPerson()"><i class="fa fa-plus"></i></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, getDocs,
  addDoc, deleteDoc, doc, updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCYREpFqzorJ_f30tQte7W1aXT6ikU0nQ4",
  authDomain: "directorio-caherengo.firebaseapp.com",
  projectId: "directorio-caherengo"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let data = [];
let officeFilter = "";

const SECRET = "KR@+0s117";

async function load(){
  const snap = await getDocs(collection(db,"directorio"));
  data = snap.docs.map(d=>({id:d.id,...d.data()}));
  render();
}
load();

function render(){
  const q = search.value.toLowerCase();
  cards.innerHTML="";
  data.filter(p=>{
    return (!officeFilter || p.oficina===officeFilter) &&
    Object.values(p).join(" ").toLowerCase().includes(q);
  }).forEach(p=>{
    cards.innerHTML+=`
    <div class="card">
      <div class="edit-icons">
        <i class="fa fa-pen" onclick="edit('${p.id}')"></i>
        <i class="fa fa-trash" onclick="remove('${p.id}')"></i>
      </div>
      <h3>${p.nombre}</h3>
      <div>${p.area}</div>
      <div>${p.puesto}</div>
      <span class="tag">${p.oficina}</span>

      <div class="info">${p.correo}</div>
      <div class="info">${p.telefono}</div>

      <div class="actions">
        <button class="mail" onclick="copy('${p.correo}')"><i class="fa fa-envelope"></i></button>
        <button class="phone" onclick="copy('${p.telefono}')"><i class="fa fa-phone"></i></button>
        <button class="whats" onclick="window.open('https://wa.me/52${p.telefono.replace(/\\D/g,'')}')"><i class="fa fa-whatsapp"></i></button>
      </div>
    </div>`;
  });
}

search.oninput=render;
window.setOffice=o=>{
  officeFilter=o;
  document.querySelectorAll('.filters button').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  render();
};

function auth(){
  return prompt("Clave de autorizaciÃ³n:");
}

window.addPerson=async()=>{
  if(auth()!==SECRET)return;
  const nombre=prompt("Nombre completo");
  if(!nombre)return;
  await addDoc(collection(db,"directorio"),{
    nombre,
    area:prompt("Ãrea"),
    puesto:prompt("Puesto"),
    oficina:prompt("Oficina"),
    correo:prompt("Correo"),
    telefono:prompt("TelÃ©fono")
  });
  load();
};

window.edit=async id=>{
  if(auth()!==SECRET)return;
  const p=data.find(x=>x.id===id);
  await updateDoc(doc(db,"directorio",id),{
    nombre:prompt("Nombre",p.nombre),
    area:prompt("Ãrea",p.area),
    puesto:prompt("Puesto",p.puesto),
    oficina:prompt("Oficina",p.oficina),
    correo:prompt("Correo",p.correo),
    telefono:prompt("TelÃ©fono",p.telefono)
  });
  load();
};

window.remove=async id=>{
  if(auth()!==SECRET)return;
  if(confirm("Â¿Eliminar registro?")){
    await deleteDoc(doc(db,"directorio",id));
    load();
  }
};

window.copy=t=>{
  navigator.clipboard.writeText(t);
};
</script>

</body>
</html>
