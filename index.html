<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Directorio General | Caherengo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ICONOS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<!-- FIREBASE COMPAT -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#0f172a;
  color:#fff;
}
header{
  background:linear-gradient(90deg,#2563eb,#1e40af);
  padding:25px;
  text-align:center;
}
.search-box{
  text-align:center;
  margin:20px;
}
.search-box input{
  width:90%;
  max-width:420px;
  padding:12px;
  border-radius:25px;
  border:none;
}
.container{
  display:flex;
  flex-wrap:wrap;
  gap:20px;
  padding:20px;
}
.card{
  background:#020617;
  width:320px;
  border-radius:16px;
  padding:18px;
  position:relative;
  box-shadow:0 10px 25px rgba(0,0,0,.4);
}
.card h3{margin:0 0 10px;font-size:18px}
.card p{font-size:13px;margin:4px 0}

.copy{
  background:#020617;
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
  margin-top:6px;
  position:relative;
}
.copy::after{
  content:"Copiar";
  position:absolute;
  top:-26px;
  right:10px;
  background:#2563eb;
  font-size:11px;
  padding:4px 8px;
  border-radius:8px;
  opacity:0;
  transition:.2s;
}
.copy:hover::after{opacity:1}
.copy.copied::after{
  content:"Copiado";
  background:#16a34a;
  opacity:1;
}

.actions{
  display:flex;
  gap:10px;
  margin-top:12px;
}
.actions a{
  flex:1;
  text-align:center;
  padding:10px;
  border-radius:12px;
  color:#fff;
  font-size:16px;
}
.mail{background:#2563eb}
.phone{background:#10b981}
.chat{background:#22c55e}

.admin{
  position:absolute;
  top:10px;
  right:10px;
  display:flex;
  gap:8px;
}
.admin i{
  cursor:pointer;
  font-size:14px;
  opacity:.7;
}
.admin i:hover{opacity:1}

#addBtn{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#2563eb;
  color:#fff;
  border:none;
  border-radius:50%;
  width:52px;
  height:52px;
  font-size:26px;
  cursor:pointer;
}
footer{
  text-align:center;
  padding:25px;
  font-size:12px;
  opacity:.6;
}
</style>
</head>

<body>

<header>
  <h1>üìò Directorio General</h1>
  <p>Caherengo | Uso interno</p>
</header>

<div class="search-box">
  <input id="search" placeholder="Buscar por nombre, puesto o √°rea‚Ä¶" onkeyup="filterCards()">
</div>

<div class="container" id="cards"></div>

<button id="addBtn" onclick="addPerson()">+</button>

<footer>
  Directorio interno ¬∑ Administrado por Sistemas
</footer>

<script>
/* üî• FIREBASE CONFIG (TU PROYECTO) */
const firebaseConfig = {
  apiKey: "AIzaSyCYREpFqzorJ_f30tQte7W1aXT6ikU0nQ4",
  authDomain: "directorio-caherengo.firebaseapp.com",
  projectId: "directorio-caherengo",
  storageBucket: "directorio-caherengo.firebasestorage.app",
  messagingSenderId: "190032909215",
  appId: "1:190032909215:web:905d9cc19978cf50de23aa"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let personas = [];

/* üîÑ CARGAR DATOS */
db.collection("personas").orderBy("createdAt","desc")
.onSnapshot(snap=>{
  personas=[];
  snap.forEach(doc=>personas.push({id:doc.id,...doc.data()}));
  render(personas);
});

/* üé® RENDER */
function render(data){
  const c=document.getElementById("cards");
  c.innerHTML="";
  data.forEach(p=>{
    c.innerHTML+=`
    <div class="card">
      <div class="admin">
        <i class="bi bi-pencil" title="Editar" onclick="editPerson('${p.id}')"></i>
        <i class="bi bi-trash" title="Eliminar" onclick="deletePerson('${p.id}')"></i>
      </div>
      <h3>${p.nombre}</h3>
      <p><b>Puesto:</b> ${p.puesto}</p>
      <p><b>√Årea:</b> ${p.area}</p>
      <p><b>Oficina:</b> ${p.oficina}</p>

      <div class="copy" onclick="copyText('${p.correo}',this)">
        ${p.correo}
      </div>

      <div class="copy" onclick="copyText('${p.telefono}',this)">
        ${p.telefono}
      </div>

      <div class="actions">
        <a class="mail" href="mailto:${p.correo}">
          <i class="bi bi-envelope-fill"></i>
        </a>
        <a class="phone" href="tel:${p.telefono}">
          <i class="bi bi-telephone-fill"></i>
        </a>
        <a class="chat" href="https://wa.me/52${p.telefono}" target="_blank">
          <i class="bi bi-whatsapp"></i>
        </a>
      </div>
    </div>`;
  });
}

/* üîç BUSCAR */
function filterCards(){
  const v=document.getElementById("search").value.toLowerCase();
  render(personas.filter(p=>
    p.nombre.toLowerCase().includes(v) ||
    p.puesto.toLowerCase().includes(v) ||
    p.area.toLowerCase().includes(v)
  ));
}

/* üìã COPIAR */
function copyText(t,e){
  navigator.clipboard.writeText(t);
  e.classList.add("copied");
  setTimeout(()=>e.classList.remove("copied"),1200);
}

/* üîê CLAVE */
function auth(){
  return prompt("Clave de administrador:")==="KR@+0s117";
}

/* ‚ûï AGREGAR */
function addPerson(){
  if(!auth())return;
  const nombre=prompt("Nombre completo");
  if(!nombre)return;
  db.collection("personas").add({
    nombre,
    puesto:prompt("Puesto"),
    area:prompt("√Årea"),
    oficina:prompt("Oficina"),
    correo:prompt("Correo"),
    telefono:prompt("Tel√©fono"),
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });
}

/* ‚úèÔ∏è EDITAR */
function editPerson(id){
  if(!auth())return;
  const p=personas.find(x=>x.id===id);
  db.collection("personas").doc(id).update({
    nombre:prompt("Nombre",p.nombre),
    puesto:prompt("Puesto",p.puesto),
    area:prompt("√Årea",p.area),
    oficina:prompt("Oficina",p.oficina),
    correo:prompt("Correo",p.correo),
    telefono:prompt("Tel√©fono",p.telefono)
  });
}

/* üóëÔ∏è ELIMINAR */
function deletePerson(id){
  if(!auth())return;
  if(confirm("¬øEliminar este registro?")){
    db.collection("personas").doc(id).delete();
  }
}
</script>

</body>
</html>
