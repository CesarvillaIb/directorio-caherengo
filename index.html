<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Directorio General | Cahrengo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:linear-gradient(180deg,#0f172a,#020617);
  color:#fff;
}
header{
  background:linear-gradient(90deg,#2563eb,#1e40af);
  padding:30px 20px;
  text-align:center;
}
.search-box{
  display:flex;
  justify-content:center;
  margin:30px 0;
}
.search-box input{
  width:90%;
  max-width:420px;
  padding:12px 18px;
  border-radius:25px;
  border:none;
}
.container{
  padding:20px;
  display:flex;
  flex-wrap:wrap;
  gap:20px;
}
.card{
  background:rgba(15,23,42,.95);
  border-radius:16px;
  padding:20px;
  width:320px;
  position:relative;
}
.admin{
  position:absolute;
  top:12px;
  right:12px;
  display:flex;
  gap:8px;
}
.admin i{
  cursor:pointer;
  opacity:.7;
}
.copy{
  background:#020617;
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
  margin-top:6px;
}
.actions{
  display:flex;
  gap:10px;
  margin-top:14px;
}
.actions a{
  flex:1;
  text-align:center;
  padding:10px;
  border-radius:12px;
  color:#fff;
}
.mail{background:#2563eb}
.phone{background:#10b981}
.chat{background:#22c55e}

.fab{
  position:fixed;
  bottom:24px;
  right:24px;
  width:56px;
  height:56px;
  border-radius:50%;
  background:#2563eb;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:26px;
  cursor:pointer;
}

/* MODALES */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
}
.box{
  background:#020617;
  padding:20px;
  border-radius:18px;
  width:90%;
  max-width:380px;
}
.box input,select{
  width:100%;
  margin-top:10px;
  padding:12px;
  border-radius:10px;
  border:1px solid #334155;
  background:#020617;
  color:#fff;
}
.modal-actions{
  display:flex;
  gap:10px;
  margin-top:16px;
}
.save{background:#2563eb;color:#fff}
.cancel{background:#020617;color:#94a3b8;border:1px solid #334155}
button{
  flex:1;
  padding:10px;
  border-radius:10px;
  border:none;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
<h1>ðŸ“˜ Directorio General</h1>
<p>Cahrengo | Uso interno</p>
</header>

<div class="search-box">
<input id="search" placeholder="Buscar..." onkeyup="filter()">
</div>

<div class="container" id="cards"></div>

<div class="fab" onclick="askPass(openForm)">+</div>

<!-- FORM -->
<div class="modal" id="formModal">
<div class="box">
<h3 id="formTitle">Agregar</h3>
<input id="nombre" placeholder="Nombre">
<input id="puesto" placeholder="Puesto">
<input id="area" placeholder="Ãrea">
<select id="oficina">
<option>Zapopan</option>
<option>Tlajomulco</option>
<option>Aguascalientes</option>
<option>MÃ©rida</option>
<option>Guerrero Negro</option>
</select>
<input id="correo" placeholder="Correo">
<input id="telefono" placeholder="TelÃ©fono">
<div class="modal-actions">
<button class="save" onclick="save()">Guardar</button>
<button class="cancel" onclick="closeForm()">Cancelar</button>
</div>
</div>
</div>

<!-- PASSWORD -->
<div class="modal" id="passModal">
<div class="box">
<h3>Acceso administrador</h3>
<input id="pass" type="password" placeholder="Clave">
<div class="modal-actions">
<button class="save" onclick="checkPass()">Entrar</button>
<button class="cancel" onclick="closePass()">Cancelar</button>
</div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyCYREpFqzorJ_f30tQte7W1aXT6ikU0nQ4",
 authDomain:"directorio-caherengo.firebaseapp.com",
 projectId:"directorio-caherengo"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const col=collection(db,"directorio");

let data=[], editId=null, afterPass=null;

onSnapshot(col,s=>{
 data=[];
 s.forEach(d=>data.push({id:d.id,...d.data()}));
 render(data);
});

function render(list){
 cards.innerHTML="";
 list.forEach(p=>{
 cards.innerHTML+=`
 <div class="card">
  <div class="admin">
   <i class="bi bi-pencil" onclick="askPass(()=>edit('${p.id}'))"></i>
   <i class="bi bi-trash" onclick="askPass(()=>remove('${p.id}'))"></i>
  </div>
  <h3>${p.nombre}</h3>
  <p>${p.puesto}</p>
  <p>${p.area} Â· ${p.oficina}</p>
  <div class="copy" onclick="copy('${p.correo}')">${p.correo}</div>
  <div class="copy" onclick="copy('${p.telefono}')">${p.telefono}</div>
  <div class="actions">
   <a class="mail" href="mailto:${p.correo}"><i class="bi bi-envelope"></i></a>
   <a class="phone" href="tel:${p.telefono}"><i class="bi bi-telephone"></i></a>
   <a class="chat" href="https://wa.me/52${p.telefono}" target="_blank"><i class="bi bi-whatsapp"></i></a>
  </div>
 </div>`;
 });
}

window.filter=()=>{
 const v=search.value.toLowerCase();
 render(data.filter(p=>
  p.nombre.toLowerCase().includes(v)||
  p.area.toLowerCase().includes(v)||
  p.telefono.includes(v)
 ));
}

window.copy=t=>navigator.clipboard.writeText(t);

window.askPass=fn=>{
 afterPass=fn;
 passModal.style.display="flex";
}

window.checkPass=()=>{
 if(pass.value==="KR@+0s117"){
  closePass();
  afterPass();
 }else{
  pass.value="";
 }
}

window.closePass=()=>passModal.style.display="none";

window.openForm=()=>{
 editId=null;
 formTitle.innerText="Agregar";
 formModal.style.display="flex";
}

window.edit=id=>{
 const p=data.find(x=>x.id===id);
 editId=id;
 Object.assign(nombre,{value:p.nombre});
 puesto.value=p.puesto;
 area.value=p.area;
 oficina.value=p.oficina;
 correo.value=p.correo;
 telefono.value=p.telefono;
 formTitle.innerText="Editar";
 formModal.style.display="flex";
}

window.save=async()=>{
 const obj={
  nombre:nombre.value,
  puesto:puesto.value,
  area:area.value,
  oficina:oficina.value,
  correo:correo.value,
  telefono:telefono.value
 };
 editId
  ? await updateDoc(doc(db,"directorio",editId),obj)
  : await addDoc(col,obj);
 closeForm();
}

window.remove=async id=>{
 await deleteDoc(doc(db,"directorio",id));
}

window.closeForm=()=>formModal.style.display="none";
</script>

</body>
</html>
