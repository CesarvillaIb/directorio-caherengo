<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Directorio General | Cahrengo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ICONOS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<style>
body{
    margin:0;
    font-family:Arial,Helvetica,sans-serif;
    background:linear-gradient(180deg,#0f172a,#020617);
    color:#fff;
}
header{
    background:linear-gradient(90deg,#2563eb,#1e40af);
    padding:25px;
    text-align:center;
}
.search-box{
    display:flex;
    justify-content:center;
    margin:20px;
}
.search-box input{
    width:90%;
    max-width:420px;
    padding:12px 18px;
    border-radius:25px;
    border:none;
}
.container{
    padding:20px;
    display:flex;
    flex-wrap:wrap;
    gap:20px;
}
.card{
    background:#020617;
    border-radius:16px;
    padding:20px;
    width:320px;
    position:relative;
}
.card h3{margin:0 0 10px}
.copy{
    background:#0f172a;
    padding:8px 12px;
    border-radius:10px;
    font-size:13px;
    margin-top:5px;
    cursor:pointer;
}
.actions{
    display:flex;
    gap:10px;
    margin-top:12px;
}
.actions a{
    flex:1;
    text-align:center;
    padding:10px;
    border-radius:12px;
    color:#fff;
    text-decoration:none;
}
.mail{background:#2563eb}
.phone{background:#10b981}
.chat{background:#22c55e}

/* BOTONES EDITAR / ELIMINAR */
.admin-actions{
    position:absolute;
    top:10px;
    right:10px;
    display:flex;
    gap:8px;
}
.admin-actions i{
    cursor:pointer;
    font-size:14px;
    opacity:.8;
}
.admin-actions i:hover{opacity:1}

/* MODAL */
.modal{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.7);
    justify-content:center;
    align-items:center;
}
.modal-content{
    background:#020617;
    padding:20px;
    border-radius:16px;
    width:90%;
    max-width:380px;
}
.modal-content input{
    width:100%;
    padding:10px;
    margin-bottom:10px;
    border-radius:10px;
    border:none;
}
.modal-content button{
    width:100%;
    padding:10px;
    border:none;
    border-radius:12px;
    background:#2563eb;
    color:#fff;
    cursor:pointer;
}
.add-btn{
    position:fixed;
    bottom:20px;
    right:20px;
    background:#2563eb;
    width:56px;
    height:56px;
    border-radius:50%;
    font-size:26px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
}
</style>
</head>

<body>

<header>
<h1>ðŸ“˜ Directorio General</h1>
<p>Cahrengo | Uso interno</p>
</header>

<div class="search-box">
<input type="text" placeholder="Buscar..." onkeyup="filterCards(this.value)">
</div>

<div class="container" id="cards"></div>

<div class="add-btn" onclick="openModal()">+</div>

<!-- MODAL -->
<div class="modal" id="modal">
<div class="modal-content">
<h3 id="modalTitle">Agregar persona</h3>
<input id="nombre" placeholder="Nombre">
<input id="puesto" placeholder="Puesto">
<input id="area" placeholder="Ãrea">
<input id="oficina" placeholder="Oficina">
<input id="correo" placeholder="Correo">
<input id="telefono" placeholder="TelÃ©fono">
<button onclick="savePerson()">Guardar</button>
</div>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
 apiKey: "AIzaSyCYREpFqzorJ_f30tQte7W1aXT6ikU0nQ4",
 authDomain: "directorio-caherengo.firebaseapp.com",
 projectId: "directorio-caherengo",
 storageBucket: "directorio-caherengo.firebasestorage.app",
 messagingSenderId: "190032909215",
 appId: "1:190032909215:web:905d9cc19978cf50de23aa"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const PASSWORD = "KR@+0s117";

let people = [];
let editId = null;

/* CARGAR */
async function loadPeople(){
 people=[];
 const snap = await getDocs(collection(db,"personas"));
 snap.forEach(d=>people.push({id:d.id,...d.data()}));
 renderCards(people);
}
loadPeople();

/* RENDER */
function renderCards(data){
 const c=document.getElementById("cards");
 c.innerHTML="";
 data.forEach(p=>{
  c.innerHTML+=`
  <div class="card">
    <div class="admin-actions">
      <i class="bi bi-pencil" onclick="editPerson('${p.id}')"></i>
      <i class="bi bi-trash" onclick="deletePerson('${p.id}')"></i>
    </div>
    <h3>${p.nombre}</h3>
    <p>${p.puesto}</p>
    <div class="copy">${p.correo}</div>
    <div class="copy">${p.telefono}</div>
    <div class="actions">
      <a class="mail" href="mailto:${p.correo}"><i class="bi bi-envelope"></i></a>
      <a class="phone" href="tel:${p.telefono}"><i class="bi bi-telephone"></i></a>
      <a class="chat" href="https://wa.me/52${p.telefono}" target="_blank"><i class="bi bi-whatsapp"></i></a>
    </div>
  </div>`;
 });
}

/* MODAL */
window.openModal=()=>{
 editId=null;
 document.getElementById("modal").style.display="flex";
}
window.savePerson=async()=>{
 const pass=prompt("Clave de seguridad:");
 if(pass!==PASSWORD)return alert("Clave incorrecta");

 const data={
  nombre:nombre.value,
  puesto:puesto.value,
  area:area.value,
  oficina:oficina.value,
  correo:correo.value,
  telefono:telefono.value
 };

 if(editId){
  await updateDoc(doc(db,"personas",editId),data);
 }else{
  await addDoc(collection(db,"personas"),data);
 }
 document.getElementById("modal").style.display="none";
 loadPeople();
}

/* EDITAR */
window.editPerson=(id)=>{
 const p=people.find(x=>x.id===id);
 editId=id;
 Object.assign(nombre,{value:p.nombre});
 Object.assign(puesto,{value:p.puesto});
 Object.assign(area,{value:p.area});
 Object.assign(oficina,{value:p.oficina});
 Object.assign(correo,{value:p.correo});
 Object.assign(telefono,{value:p.telefono});
 document.getElementById("modal").style.display="flex";
}

/* ELIMINAR */
window.deletePerson=async(id)=>{
 const pass=prompt("Clave de seguridad:");
 if(pass!==PASSWORD)return alert("Clave incorrecta");
 await deleteDoc(doc(db,"personas",id));
 loadPeople();
}

/* FILTRO */
window.filterCards=(v)=>{
 v=v.toLowerCase();
 renderCards(people.filter(p=>p.nombre.toLowerCase().includes(v)));
}
</script>

</body>
</html>
